# eXP-RAN - an Emulator for Gaining Experience with Radio Access Networks, Edge Computing, and Slicing

eXP-RAN was tested on Ubuntu 18.04 LTS and Ubuntu Server 18.04 LTS. Although it may work in some other Debian-based Linux distributions, we do not guarantee that all features will work well.

- [Getting started](#getting-started)
- [Running your tests](#running-your-tests)
	- [Interacting with the tool](#interacting-with-the-tool)
		- [Model Adapter](#model-adapter)
		- [Topology Generator](#topology-generator)
		- [Creating your own Infrastructure and Service description files](#creating-your-own-infrastructure-and-service-description-files)
	- [Creating an emulation](#creating-an-emulation)

## Getting started

These instructions will guide you to get eXP-RAN up and running.

### Installing the prerequisites

```
sudo apt update
sudo apt install python net-tools unzip python-pip iproute2 xen-hypervisor-4.6-amd64 xen-tools openvswitch-switch openssh-server curl git
sudo pip install paramiko networkx
```

### Xen configuration

After installing the Xen Hypervisor, you need to restart your computer to load the hypervisor.

Optional extra configuration: It is highly recommend to configure the Xen dom0 RAM, more information regarding this configuration can be found in the [Xen Project Documentation](https://wiki.xenproject.org/wiki/Xen_Project_Best_Practices).

### Cloning the repository

```
git clone https://github.com/LABORA-INF-UFG/eXP-RAN
```

### Downloading the VM Template

Now you need to download eXP-RAN's Xen VM.

In order to do that, first enter the Xen VM subdirectory inside the repository you just cloned.

Make sure that the location of the Xen VM directory is correct, the directory may differ depending on in which directory you have cloned the project.

```
cd /home/$USER/eXP-RAN/XenVM/
```

Then, run the VM Downloader script.

```
sh VMDownloader.sh
```

Once that is done, you should have two files downloaded to your machine, one is the VM disk and the other is the VM swap disk.

### Creating the eXP-RAN user

In order for eXP-RAN to save the results of the tests from the VMs to your host, you need to create a user on your host for eXP-RAN.

This is necessary because eXP-RAN copy the results from the VMs to your host via [SCP](https://help.ubuntu.com/community/SSH/TransferFiles), and instead of asking for the user's password to transfer the files, a more secure approach is to a create a user without root permissions only to copy the results files.

To create your non-root eXP-RAN user, simply type:

```
sudo useradd -m expran -s /bin/bash
```

For eXP-RAN to work properly, the eXP-RAN user password has to be "necos". You must change eXP-RAN's password with the following command:

```
sudo passwd expran
```

Then, type necos for "Enter new UNIX password:" and "Retype new UNIX password:".

Remember that this user is a non-root user and it is only going to be used for SCP, so the are no big security issues regarding the creation of this user.

Nonetheless, you can delete this user at any moment by typing:

```
sudo userdel expran && sudo rm -rf /home/expran
```

Alternatively, eXP-RAN has a module to destroy the created infrastructure. This module already deletes eXP-RAN's user after the emulation is done.

Now eXP-RAN is fully configured and you can start your tests!

## Running your tests

This section is going to detail how can you emulate your vRAN/MEC or video service.

### Interacting with the tool

There are three ways in which the user can interact with the tool. The figure below details these interactions.

<div align="center">
<img src="Figures/System_Components.jpg" >
</div>

The figure above represents eXP-RAN workflow and system modules.

Dot arrows represent optional flow; double arrows identify user inputs; single arrows represent mandatory flow; rectangle with dashed lines represent input files; while rectangle with solid lines identify the system modules.

Let's start with the Model Adapter module.

#### Model Adapter

The model adapter is responsible for converting the output of a [CPLEX](https://www.ibm.com/analytics/cplex-optimizer) optimisation model into an Infrastructure and Service description file (step 2a in the figure above) for eXP-RAN.

The Infrastructure Description file can be used to emulate any service. However, the Service Description file generated by the model adapter can only be used to emulate vRAN/MEC services.

This module must be implemented by the user for each different model to be evaluated. However, this is much easier then implementing the solution from scratch, since eXP-RAN specifies well defined interfaces and generalizations so that a plethora of different models can be converted and have their performance assessed.

The model adapter is at Scripts/Model_Adapter.

You can run the model adapter by running the following script combined with the solution and topology file generated by CPLEX. The username information is also necessary. Example:

```
python model_adapter.py Mark sol_fluidran.json top_file.json
```

Where:\
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Mark – Your username.\
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sol_fluidran.json – Your solution file.\
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; top_file.json – Your topology file.

After running the script, both the infrastructure and vRAN/MEC service description files are going to be exported to the same directory of the model adapter.

The optimisation model of the example is the [FluidRAN model](https://ieeexplore.ieee.org/document/8486243).

#### Topology Generator

The topology generator is designed to generate random RAN topologies.

We use a [Waxman graph](https://networkx.github.io/documentation/networkx-1.10/reference/generated/networkx.generators.geometric.waxman_graph.html) to generate the topology, a type of graph very similar to the topologies usually found in RANs.

The topology generator is at Scripts/Topology_Generator.

You can run the topology generator by running the following script combined with the Waxman arguments:

```
python top_gen.py -u USERNAME -n NumberOfNodes -a Alpha -b Beta -l L
```

Where:\
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -u (string) – Your username.\
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -n (int) – Number of nodes.\
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -a (float) – Alpha Model parameter.\
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -b (float) – Beta Model parameter.\
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -l (float) – Maximum distance between nodes.

The default arguments are:

```
python top_gen.py -u John -n 3 -a 0.4 -b 0.1 -l 70
```

The JSON output containing the topology description is located at the same directory of the topology generator script.

Once the topology is created, nodes are labeled according to the following proportions: 5% of the nodes are labed MEC host nodes; 30% are base stations nodes; and 65% are forwarding nodes. This was based on studies conducted in [this paper](https://ieeexplore.ieee.org/document/7248926).

Finally, links are characterized by randomly choosing one of the links profiles derived from studies conducted in [this paper](https://ieeexplore.ieee.org/document/8283832). The generated topology is then converted into a Infrastructure Description file (step 2b in the figure above).

Keep in mind that only the RAN topology is generated. The user needs to create the Docker containers information as well as the service file.

However, the topology generator helps users with limited knowledge of RAN/EC scenarios and supports educational purposes.

#### Creating your own Infrastructure and Service description files

The third method of interaction (step 1c in the figure above) allows the user to specify his own infrastructure and services files (step 1c in the figure above), which can be very useful for small use cases.

In this case, the user describes the infrastructure and services by writing JSON files following the eXP-RAN notation.

Examples of eXP-RAN infrastructure and services files can be found at the Description_Files directory.

Where:\
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; vRAN_MEC_services.json – Example of vRAN/MEC Service Description file.\
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; vRAN_MEC_Infra.json – Example of Infrastructure Description file that will support the vRAN/MEC service file example.\
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; VideoStream_services.json – Example of video streaming Service Description file.\
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; VideoStream_Infra.json – Example of Infrastructure Description file that will support the video streaming service file example.

Please note that the same Infrastructure Description file can support both vRAN/MEC and video streaming service files. We uploaded two different Infrastructure Description files just to give more examples to the user.

Please note that in the video streaming service file, the first node number should always be the same, as it is going to be the video server. The video client is the last node, and it should always alternate between two nodes, in order to represent "Premium" and "Best-Effort" clients.

Now, you should have both your Infrastructure and Services files created by any of the three methods above. It is emulation time!

### Creating an emulation